Bootstrap: library
From: ubuntu:18.04
Stage: build

# this will prevent Unicode decode errors
%environment
   export LC_ALL=C.UTF-8

%post
   export LC_ALL=C.UTF-8
   export DEBIAN_FRONTEND=noninteractive
   apt-get update && apt-get upgrade -y
   apt-get install -y software-properties-common
   apt-add-repository universe
   apt-add-repository multiverse
   apt-get update
   apt-get install -y build-essential
   apt-get install -y cmake
   apt-get install -y python3 python3-pip
   apt-get install -y git wget unzip

   apt-get install -y libhdf5-dev
   apt-get install -y python3-h5py
   #
   apt-get install -y libeigen3-dev
   apt-get install -y libhts-dev
   #
   apt-get install -y bowtie2 samtools ncbi-blast+ minimap miniasm
   apt-get install -y fastqc poretools clustalo clustalx spades
   #
   ## Deepbinner
   (
     git clone https://github.com/rrwick/Deepbinner.git
     pip3 install ./Deepbinner
   )
   rm -Rf Deepbinner
   #
   # Nanopolish
   (
     git clone --recursive https://github.com/jts/nanopolish.git
     cd nanopolish
     export CXXFLAGS="-I/usr/include/hdf5/serial -I/usr/include/eigen3"
     export LDFLAGS="-L /usr/lib/x86_64-linux-gnu/hdf5/serial"
     make HDF5=noinstall EIGEN=noinstall HTS=noinstall
     cp nanopolish /usr/local/bin
   )
   rm -Rf nanopolish
   #
   # trimAl
   (
     wget http://trimal.cgenomics.org/_media/trimal.v1.2rev59.tar.gz
     tar xfvz trimal.v1.2rev59.tar.gz
     cd trimAl/source
     make -j 2
     cp trimal readal /usr/local/bin
   )
   rm -Rf trimal.v1.2rev59.tar.gz trimAl
#   #
#   #Filtlong
#   (
#      git clone https://github.com/rrwick/Filtlong.git
#      cd Filtlong
#      make
#      cp bin/filtlong /usr/local/bin
#   )
#   #
#   # Racon
#   (
#      git clone --recursive https://github.com/isovic/racon.git racon
#      cd racon
#      mkdir build
#      cd build
#      cmake -DCMAKE_BUILD_TYPE=Release ..
#      make
#      make install
#   )
#   # minimap2
#   (
#      wget https://github.com/lh3/minimap2/releases/download/v2.15/minimap2-2.15.tar.bz2
#      tar xfvj minimap2-2.15.tar.bz2
#      cd minimap2-2.15
#      make
#      cp minimap2 /usr/local/bin
#      cd ..
#      rm -Rf minimap2-2.15
#   )
#   #
#   # Pilon
#   (
#      wget https://github.com/broadinstitute/pilon/releases/download/v1.23/pilon-1.23.jar
#     
#      cp pilon-1.23.jar /usr/local/bin
#      cat <<EOT > /usr/local/bin/pilon
##!/bin/bash
#
#exec java -jar /usr/local/bin/pilon-1.23.jar \$@
#EOT
#     
#      chmod a+x /usr/local/bin/pilon
#   )
#   #
#   # Unicycler (needs pilon)
#   (
#      git clone https://github.com/rrwick/Unicycler.git
#      cd Unicycler
#      python3 setup.py install
#   )
#   #
#   # Mauve
#   (
#      wget http://darlinglab.org/mauve/snapshots/2015/2015-02-13/linux-x64/mauve_linux_snapshot_2015-02-13.tar.gz
#      tar xfvz mauve_linux_snapshot_2015-02-13.tar.gz -C /usr/local/lib
#      ln -s ../lib/mauve_snapshot_2015-02-13/Mauve /usr/local/bin/Mauve
#   )
#   #
#   # PhyML
#   (
#      wget http://www.atgc-montpellier.fr/download/sources/sms/sms-1.8.1.zip
#      unzip sms-1.8.1.zip
#      cd sms-1.8.1
#      make
#      cp phyml-src/phyml /usr/local/bin
#   )
#
#
